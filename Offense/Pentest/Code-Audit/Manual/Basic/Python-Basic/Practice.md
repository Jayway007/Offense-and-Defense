# utf-coding
```python
# !/usr/bin/python
# -*- coding: utf-8 -*-
```
# requests
```python
import requests
import json
import os

# define the Class
class DemoRequest():
  url = None
  headers = None
  proxies = None
  
  def _init_(self, url, proxy_user, proxy_pass):
     self.url = url
     self.headers = {"Content-Type": "application/json"}
     self.proxy_init(proxy_user, proxy_pass)
     
  def proxy_init(self, proxy_user, proxy_pass):
    proxy = ""
    port = 5000
    proxy_http = 'http://' + proxy_user + ':' + proxy_pass + '@' + proxy + ':' + port
    
  def exec_request(delf, json_body)  
      path = '/request'
      return self.post_request(path, json_body)
    
  def post_request(self, path, json=None):
    try:
       url = self.url + path
       response = requests.post(url, json=json, headers=self.headers, proxies = self.proxies, verify=False)
       return handler_resp(path, 'post', response)
    except Exception as Ex:
       print("Request error.")
    return None, {"Result": "Request error"}   
  
  def handler_resp(self, path, method, response):
   # NULL pointer error
      code = None
      json_result = {}
      code = response.status_code
      if code == 200:
         json_result = json.loads(response.text)
         return code, json_result
      else if code == 404:
         json_result = '{"Result": "'+ method +' not found."}'
      else:
         json_result = '{"Result": "'+ method +' failed."}'
      return code, json_result
      
def write_result(url, response, id):
    try:
       current_dic = os.getcwd()
       result_dic = "Report" + time.strftime('%Y%m%d', time.localtime()) + "_" + str(id)
       dest_dic = os.path.join(current_dic, result_dic)
       if not path.exists(dest_dic):
         os.makedirs(dest_dic)
         
       result = []
       list = response["key"]
       for item in list:
           dict = {}
           dict["name"] = item.get('name','unknown')
           dict["key"] = item.get('key','unknown')
           result.append(dict)
       file_name = "report_" + url + "_" + time.strftime('%Y%m%d', time.localtime())
       result_str = json.dumps(result)
       with open (file_name, "w", encoding ='UTF-8') as outfile:
          outfile.write(result_str)

if _name_ == '__main__':
   print("Start request task at [{}]."
          .format(time.strftime("%Y/%m/%d %H:%M:%S")))
   # Open file and add in a list       
   try:
       target_list = []
       file = open("test.txt", 'r')
       list = file.readlines()
       for item in list:
           single = item.strip().replace("\r\n", "").replace("\n", "")
           target_list.append(single)
           
      # create a new object
      url = "https://jayway.top/test";
      req_url = url.split("/")[2]
      obj = DemoRequest(url,'admin','admin')
      
      for value in target_list:
          if not value:
             print("End requests")
             continue           
          try:
              json_body = {"key": value} 
              (code, resp) = obj.exec_request(json_body)
              if code = 200 and resp:
                 id = resp['id']
                 write_result(url, resp, id)
                 
          exception Exception as Ex:
             print("Read file wrong.") 
           
    exception Exception as Ex:
        print("Read file wrong.")  
```

# Config
settings.py
```python
class ConfigUtil():
  # mysql configure
  host = "localhost"
  port = 3306
  user = "root"
  pwd = "root"
  name = "test"
  
  # filename definition
  Date = time.strftime("%Y%m%d")
  former_file = 'former_' + Date + '.json'
```

# pymysql
```python
import pymysql
from settings import ConfigUtil

def query_result(sql):
  db_result = []
  db_host = ConfigUtil.host
  db_port = ConfigUtil.port
  db_user = ConfigUtil.user
  db_pwd = ConfigUtil.pwd
  db_name = ConfigUtil.name
  
  try:
     conn = pymysql.connect(host=db_host, user=db_user, passwd=db_pwd, db=db_name)
     cur = conn.cursor()
     cur.execute(sql)
     conn.commit()
     db_result = cur.fetchall()
  exception Exception as Ex:
     print("Error")
  finally:
     cur.close()
     conn.close()
  return db_result   
```
# Excel
```python
import openpyxl

def xl_handler(filename):
    obj = openpyxl.load_workbook(filename)
```
# Socket
```python
import socket

def socket_test(ip, port, json):
    try:
       s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
       s.connect(ip, port)
       json_str = json.dumps(json)
       s.send(json_str)
       s.close()
    except Exception as Ex:
       logger.error("Error")
    return None   
```
# Command
```python
import subprocess

def exec():
    proc = subprocess.Popen([/bin/bash, -i, ls], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
```
